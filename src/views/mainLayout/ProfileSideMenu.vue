<template>
  <div class="profile-menu">
    <UserInfoMini />
    <ul>
      <li>
        <router-link class="item-list" :to="`/profile`" :class="activeRoute === 'my' ? 'active' : ''">
          <svg class="icon-profile">
            <use xlink:href="#home"></use>
          </svg>
          Мой профиль
          <svg class="icon-arrow">
            <use xlink:href="#arrow"></use>
          </svg>
        </router-link>
      </li>
      <li>
        <router-link class="item-list" :to="`/profile/education`" :class="activeRoute === 'education' ? 'active' : ''">
          <svg class="icon-education">
            <use xlink:href="#education"></use>
          </svg>
          <div class="item-list-name">
            Заявки
            <span v-if="user.formValues.length && user.formValues.some((el) => !el.viewedByUser)" class="sup-cymbol-counter">
              {{ user.getNotViewedApplicationsCount() }}
            </span>
          </div>
          <svg class="icon-arrow">
            <use xlink:href="#arrow"></use>
          </svg>
        </router-link>
      </li>
      <li v-if="user.questions.length > 0">
        <router-link class="item-list" :to="`/profile/question-answer`" :class="activeRoute === 'question-answer' ? 'active' : ''">
          <svg class="icon-education">
            <use xlink:href="#question"></use>
          </svg>
          <div class="item-list-name">Вопросы-ответы</div>
          <svg class="icon-arrow">
            <use xlink:href="#arrow"></use>
          </svg>
        </router-link>
      </li>
      <li v-if="user.comments.length > 0">
        <router-link class="item-list" :to="`/profile/user-comments`" :class="activeRoute === 'user-comments' ? 'active' : ''">
          <svg class="icon-education">
            <use xlink:href="#question"></use>
          </svg>
          <div class="item-list-name">Мои комментарии</div>
          <svg class="icon-arrow">
            <use xlink:href="#arrow"></use>
          </svg>
        </router-link>
      </li>
      <li>
        <router-link class="item-list" :to="`/profile/settings`" :class="activeRoute === 'settings' ? 'active' : ''">
          <svg class="icon-settings">
            <use xlink:href="#settings"></use>
          </svg>
          Настройки
          <svg class="icon-arrow">
            <use xlink:href="#arrow"></use>
          </svg>
        </router-link>
      </li>
    </ul>
  </div>

  <svg width="0" height="0" class="hidden">
    <symbol id="home" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path
        d="M5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V11C21.0008 10.8684 20.9755 10.7379 20.9258 10.6161C20.876 10.4943 20.8027 10.3834 20.71 10.29L12.71 2.29C12.5226 2.10375 12.2692 1.99921 12.005 1.99921C11.7408 1.99921 11.4874 2.10375 11.3 2.29L3.3 10.29C3.20551 10.3826 3.13034 10.4931 3.07885 10.6149C3.02735 10.7368 3.00055 10.8677 3 11V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22ZM10 20V15H14V20H10ZM5 11.41L12 4.41L19 11.41V20H16V15C16 14.4696 15.7893 13.9609 15.4142 13.5858C15.0391 13.2107 14.5304 13 14 13H10C9.46957 13 8.96086 13.2107 8.58579 13.5858C8.21071 13.9609 8 14.4696 8 15V20H5V11.41Z"
      ></path>
    </symbol>

    <symbol id="education" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M7 18H17V16H7V18ZM17 14H7V12H17V14ZM7 10H11V8H7V10Z"></path>
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M6 2C5.20435 2 4.44129 2.31607 3.87868 2.87868C3.31607 3.44129 3 4.20435 3 5V19C3 19.7956 3.31607 20.5587 3.87868 21.1213C4.44129 21.6839 5.20435 22 6 22H18C18.7956 22 19.5587 21.6839 20.1213 21.1213C20.6839 20.5587 21 19.7956 21 19V9C21 7.14348 20.2625 5.36301 18.9497 4.05025C17.637 2.7375 15.8565 2 14 2H6ZM6 4H13V9H19V19C19 19.2652 18.8946 19.5196 18.7071 19.7071C18.5196 19.8946 18.2652 20 18 20H6C5.73478 20 5.48043 19.8946 5.29289 19.7071C5.10536 19.5196 5 19.2652 5 19V5C5 4.73478 5.10536 4.48043 5.29289 4.29289C5.48043 4.10536 5.73478 4 6 4V4ZM15 4.1C15.786 4.26102 16.5218 4.60849 17.1455 5.11315C17.7692 5.61782 18.2625 6.26492 18.584 7H15V4.1Z"
      ></path>
    </symbol>
    <symbol id="question" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path
        d="M13.0691 12H8.06914C7.80392 12 7.54957 12.1054 7.36203 12.2929C7.1745 12.4804 7.06914 12.7348 7.06914 13C7.06914 13.2652 7.1745 13.5196 7.36203 13.7071C7.54957 13.8946 7.80392 14 8.06914 14H13.0691C13.3344 14 13.5887 13.8946 13.7762 13.7071C13.9638 13.5196 14.0691 13.2652 14.0691 13C14.0691 12.7348 13.9638 12.4804 13.7762 12.2929C13.5887 12.1054 13.3344 12 13.0691 12ZM14.0691 20H6.06914C5.80392 20 5.54957 19.8946 5.36203 19.7071C5.1745 19.5196 5.06914 19.2652 5.06914 19V5C5.06914 4.73478 5.1745 4.48043 5.36203 4.29289C5.54957 4.10536 5.80392 4 6.06914 4H11.0691V7C11.0691 7.79565 11.3852 8.55871 11.9478 9.12132C12.5104 9.68393 13.2735 10 14.0691 10H17.0691V11C17.0691 11.2652 17.1745 11.5196 17.362 11.7071C17.5496 11.8946 17.8039 12 18.0691 12C18.3344 12 18.5887 11.8946 18.7762 11.7071C18.9638 11.5196 19.0691 11.2652 19.0691 11V9C19.0735 8.98024 19.0735 8.95976 19.0691 8.94C19.0607 8.84679 19.037 8.75559 18.9991 8.67V8.58C18.9511 8.47718 18.8869 8.38267 18.8091 8.3L12.8091 2.3C12.7243 2.22026 12.6261 2.15597 12.5191 2.11C12.5191 2.11 12.4691 2.11 12.4391 2.11C12.3406 2.05298 12.2319 2.01562 12.1191 2H6.11914C5.32349 2 4.56043 2.31607 3.99782 2.87868C3.43521 3.44129 3.11914 4.20435 3.11914 5V19C3.11914 19.7956 3.43521 20.5587 3.99782 21.1213C4.56043 21.6839 5.32349 22 6.11914 22H14.1191C14.3844 22 14.6387 21.8946 14.8262 21.7071C15.0138 21.5196 15.1191 21.2652 15.1191 21C15.1191 20.7348 15.0138 20.4804 14.8262 20.2929C14.6387 20.1054 14.3844 20 14.1191 20H14.0691ZM13.0691 5.41L15.6491 8H14.0691C13.8039 8 13.5496 7.89464 13.362 7.70711C13.1745 7.51957 13.0691 7.26522 13.0691 7V5.41ZM18.6391 20.29C18.5916 20.247 18.5415 20.2069 18.4891 20.17C18.3792 20.0986 18.2572 20.0477 18.1291 20.02C17.9685 19.9878 17.8024 19.9956 17.6455 20.0427C17.4885 20.0898 17.3456 20.1747 17.2291 20.29C17.1354 20.383 17.061 20.4936 17.0102 20.6154C16.9595 20.7373 16.9333 20.868 16.9333 21C16.9333 21.132 16.9595 21.2627 17.0102 21.3846C17.061 21.5064 17.1354 21.617 17.2291 21.71C17.4154 21.8947 17.6668 21.9989 17.9291 22C18.0938 22.0008 18.2561 21.961 18.4016 21.884C18.5471 21.8071 18.6714 21.6954 18.7634 21.5589C18.8554 21.4223 18.9123 21.2652 18.929 21.1014C18.9457 20.9377 18.9217 20.7723 18.8591 20.62C18.8048 20.4985 18.7304 20.3869 18.6391 20.29V20.29ZM13.0691 16H8.06914C7.80392 16 7.54957 16.1054 7.36203 16.2929C7.1745 16.4804 7.06914 16.7348 7.06914 17C7.06914 17.2652 7.1745 17.5196 7.36203 17.7071C7.54957 17.8946 7.80392 18 8.06914 18H13.0691C13.3344 18 13.5887 17.8946 13.7762 17.7071C13.9638 17.5196 14.0691 17.2652 14.0691 17C14.0691 16.7348 13.9638 16.4804 13.7762 16.2929C13.5887 16.1054 13.3344 16 13.0691 16ZM17.9291 13C17.4022 12.9997 16.8845 13.1381 16.4281 13.4014C15.9716 13.6648 15.5926 14.0437 15.3291 14.5C15.2635 14.6143 15.221 14.7403 15.204 14.871C15.1871 15.0017 15.196 15.1344 15.2304 15.2616C15.2648 15.3888 15.3238 15.508 15.4043 15.6124C15.4847 15.7168 15.5849 15.8043 15.6991 15.87C15.8134 15.9357 15.9395 15.9782 16.0701 15.9951C16.2008 16.0121 16.3336 16.0031 16.4608 15.9687C16.588 15.9344 16.7072 15.8753 16.8116 15.7949C16.916 15.7144 17.0035 15.6143 17.0691 15.5C17.157 15.3478 17.2835 15.2214 17.4358 15.1336C17.5881 15.0458 17.7609 14.9998 17.9367 15C18.1125 15.0003 18.2851 15.0469 18.4371 15.1351C18.5892 15.2234 18.7153 15.3501 18.8027 15.5026C18.8901 15.6551 18.9358 15.828 18.9351 16.0038C18.9345 16.1796 18.8875 16.3521 18.7989 16.5039C18.7103 16.6558 18.5833 16.7816 18.4306 16.8687C18.2779 16.9558 18.1049 17.0011 17.9291 17C17.6639 17 17.4096 17.1054 17.222 17.2929C17.0345 17.4804 16.9291 17.7348 16.9291 18C16.9291 18.2652 17.0345 18.5196 17.222 18.7071C17.4096 18.8946 17.6639 19 17.9291 19C18.7248 19 19.4879 18.6839 20.0505 18.1213C20.6131 17.5587 20.9291 16.7956 20.9291 16C20.9291 15.2044 20.6131 14.4413 20.0505 13.8787C19.4879 13.3161 18.7248 13 17.9291 13ZM8.06914 10H9.06914C9.33436 10 9.58871 9.89464 9.77625 9.70711C9.96378 9.51957 10.0691 9.26522 10.0691 9C10.0691 8.73478 9.96378 8.48043 9.77625 8.29289C9.58871 8.10536 9.33436 8 9.06914 8H8.06914C7.80392 8 7.54957 8.10536 7.36203 8.29289C7.1745 8.48043 7.06914 8.73478 7.06914 9C7.06914 9.26522 7.1745 9.51957 7.36203 9.70711C7.54957 9.89464 7.80392 10 8.06914 10Z"
      ></path>
    </symbol>

    <symbol id="settings" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path
        d="M12.0002 4C11.7349 4 11.4806 4.10536 11.293 4.29289C11.1055 4.48043 11.0002 4.73478 11.0002 5C11.0002 6.692 8.95415 7.54 7.75715 6.343C7.6649 6.24749 7.55456 6.17131 7.43256 6.1189C7.31055 6.06649 7.17933 6.0389 7.04655 6.03775C6.91377 6.03659 6.78209 6.0619 6.6592 6.11218C6.5363 6.16246 6.42465 6.23671 6.33076 6.3306C6.23686 6.4245 6.16261 6.53615 6.11233 6.65904C6.06205 6.78194 6.03675 6.91362 6.0379 7.0464C6.03905 7.17918 6.06664 7.3104 6.11905 7.4324C6.17146 7.55441 6.24764 7.66475 6.34315 7.757C7.54015 8.954 6.69315 11 5.00015 11C4.73493 11 4.48058 11.1054 4.29304 11.2929C4.10551 11.4804 4.00015 11.7348 4.00015 12C4.00015 12.2652 4.10551 12.5196 4.29304 12.7071C4.48058 12.8946 4.73493 13 5.00015 13C6.69215 13 7.54015 15.046 6.34315 16.243C6.16099 16.4316 6.0602 16.6842 6.06248 16.9464C6.06476 17.2086 6.16992 17.4594 6.35533 17.6448C6.54074 17.8302 6.79155 17.9354 7.05375 17.9377C7.31595 17.94 7.56855 17.8392 7.75715 17.657C8.95415 16.46 11.0002 17.307 11.0002 19C11.0002 19.2652 11.1055 19.5196 11.293 19.7071C11.4806 19.8946 11.7349 20 12.0002 20C12.2654 20 12.5197 19.8946 12.7073 19.7071C12.8948 19.5196 13.0002 19.2652 13.0002 19C13.0002 17.308 15.0462 16.46 16.2432 17.657C16.3354 17.7525 16.4457 17.8287 16.5677 17.8811C16.6898 17.9335 16.821 17.9611 16.9537 17.9622C17.0865 17.9634 17.2182 17.9381 17.3411 17.8878C17.464 17.8375 17.5757 17.7633 17.6695 17.6694C17.7634 17.5755 17.8377 17.4638 17.888 17.341C17.9383 17.2181 17.9636 17.0864 17.9624 16.9536C17.9612 16.8208 17.9337 16.6896 17.8813 16.5676C17.8288 16.4456 17.7527 16.3352 17.6572 16.243C16.4602 15.046 17.3072 13 19.0002 13C19.2654 13 19.5197 12.8946 19.7073 12.7071C19.8948 12.5196 20.0002 12.2652 20.0002 12C20.0002 11.7348 19.8948 11.4804 19.7073 11.2929C19.5197 11.1054 19.2654 11 19.0002 11C17.3082 11 16.4602 8.954 17.6572 7.757C17.8393 7.5684 17.9401 7.31579 17.9378 7.0536C17.9355 6.7914 17.8304 6.54059 17.645 6.35518C17.4596 6.16977 17.2087 6.0646 16.9466 6.06232C16.6844 6.06005 16.4318 6.16084 16.2432 6.343C15.0462 7.54 13.0002 6.693 13.0002 5C13.0002 4.73478 12.8948 4.48043 12.7073 4.29289C12.5197 4.10536 12.2654 4 12.0002 4V4ZM9.00815 4.777C9.06345 4.02127 9.40269 3.31446 9.9577 2.79858C10.5127 2.28269 11.2424 1.99594 12.0002 1.99594C12.7579 1.99594 13.4876 2.28269 14.0426 2.79858C14.5976 3.31446 14.9368 4.02127 14.9922 4.777C15.566 4.28418 16.3048 4.02631 17.0606 4.05501C17.8164 4.08371 18.5336 4.39686 19.0683 4.93178C19.6031 5.46669 19.9161 6.18387 19.9446 6.93972C19.9732 7.69557 19.7151 8.43431 19.2222 9.008C19.9779 9.06317 20.6848 9.40229 21.2007 9.95722C21.7167 10.5122 22.0036 11.2418 22.0037 11.9995C22.0038 12.7573 21.7172 13.487 21.2014 14.0421C20.6856 14.5972 19.9789 14.9366 19.2232 14.992C19.716 15.5658 19.9738 16.3046 19.9451 17.0604C19.9164 17.8163 19.6033 18.5334 19.0684 19.0682C18.5335 19.603 17.8163 19.916 17.0604 19.9445C16.3046 19.973 15.5658 19.715 14.9922 19.222C14.9368 19.9777 14.5976 20.6845 14.0426 21.2004C13.4876 21.7163 12.7579 22.0031 12.0002 22.0031C11.2424 22.0031 10.5127 21.7163 9.9577 21.2004C9.40269 20.6845 9.06345 19.9777 9.00815 19.222C8.43446 19.715 7.69573 19.973 6.93988 19.9445C6.18402 19.916 5.46684 19.603 4.93193 19.0682C4.39702 18.5334 4.08386 17.8163 4.05516 17.0604C4.02646 16.3046 4.28433 15.5658 4.77715 14.992C4.02142 14.9367 3.31462 14.5975 2.79873 14.0424C2.28284 13.4874 1.99609 12.7577 1.99609 12C1.99609 11.2422 2.28284 10.5126 2.79873 9.95755C3.31462 9.40253 4.02142 9.0633 4.77715 9.008C4.28283 8.43441 4.0237 7.6951 4.05174 6.93842C4.07979 6.18173 4.39294 5.46364 4.92836 4.92821C5.46379 4.39279 6.18188 4.07964 6.93857 4.05159C7.69526 4.02354 8.43456 4.28268 9.00815 4.777V4.777Z"
      ></path>
      <path
        d="M11.9997 10C11.4692 10 10.9605 10.2107 10.5855 10.5858C10.2104 10.9609 9.99968 11.4696 9.99968 12C9.99968 12.5304 10.2104 13.0391 10.5855 13.4142C10.9605 13.7893 11.4692 14 11.9997 14C12.5301 14 13.0388 13.7893 13.4139 13.4142C13.789 13.0391 13.9997 12.5304 13.9997 12C13.9997 11.4696 13.789 10.9609 13.4139 10.5858C13.0388 10.2107 12.5301 10 11.9997 10ZM9.17168 9.172C9.54066 8.78996 9.98204 8.48523 10.4701 8.2756C10.9581 8.06596 11.483 7.95562 12.0141 7.951C12.5452 7.94639 13.0719 8.04759 13.5635 8.24872C14.0551 8.44984 14.5017 8.74685 14.8773 9.12242C15.2528 9.498 15.5498 9.9446 15.751 10.4362C15.9521 10.9278 16.0533 11.4545 16.0487 11.9856C16.0441 12.5167 15.9337 13.0416 15.7241 13.5296C15.5144 14.0176 15.2097 14.459 14.8277 14.828C14.0733 15.5566 13.0629 15.9598 12.0141 15.9507C10.9653 15.9416 9.96203 15.5209 9.2204 14.7793C8.47877 14.0376 8.05809 13.0344 8.04898 11.9856C8.03987 10.9368 8.44304 9.92641 9.17168 9.172V9.172Z"
      ></path>
    </symbol>

    <symbol id="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
      <path d="M6 15L11 10L6 5L7 3L14 10L7 17L6 15Z"></path>
    </symbol>
  </svg>
</template>

<script lang="ts">
import { computed, defineComponent, onBeforeMount, Ref, ref, watch } from 'vue';
import { useRoute } from 'vue-router';

import IUser from '@/interfaces/IUser';
import Provider from '@/services/Provider';
import UserInfoMini from '@/views/mainLayout/elements/UserInfoMini.vue';
export default defineComponent({
  name: 'ProfileSideMenu',
  components: { UserInfoMini },
  setup() {
    const activeRoute: Ref<string> = ref('');
    const route = useRoute();
    watch(route, () => {
      setActiveMenu();
    });

    const setActiveMenu = () => {
      if (!Provider.route().meta.profile) {
        return;
      }
      activeRoute.value = Provider.route().meta.profile as string;
    };

    onBeforeMount(() => {
      setActiveMenu();
    });

    const user: Ref<IUser> = computed(() => Provider.store.getters['users/item']);
    const hasNewAnswers: Ref<boolean> = computed(() => user.value.hasNewAnswers());
    const countNewAnswers: Ref<number> = computed(() => user.value.countNewAnswers());

    return {
      user,
      hasNewAnswers,
      countNewAnswers,
      activeRoute,
    };
  },
});
</script>

<style lang="scss" scoped>
.profile-menu {
  min-width: 272px;
  background: #ffffff;
  height: 73vh;
  margin-right: 30px;
}

.icon-profile {
  width: 24px;
  height: 24px;
  padding-right: 10px;
  padding-left: 20px;
}

.icon-education {
  width: 24px;
  height: 24px;
  padding-right: 10px;
  padding-left: 20px;
}

.icon-question {
  width: 24px;
  height: 24px;
  padding-right: 10px;
  padding-left: 20px;
}

.icon-settings {
  width: 24px;
  height: 24px;
  padding-right: 10px;
  padding-left: 20px;
}

.icon-arrow {
  position: absolute;
  width: 18px;
  height: 18px;
  right: 15px;
  fill: #ffffff;
}

.profile-menu ul {
  list-style: none;
  transition: color 0.3s ease 0s;
  align-items: center;
  font-family: Roboto, Verdana, sans-serif;
  font-size: 14px;
  padding: 0;
}

.profile-menu li {
  justify-content: left;
  width: 100%;
  text-decoration: none;
  align-items: center;
  border-top: 1px solid #e0e5ee;
}

.profile-menu li:last-child {
  border-bottom: 1px solid #e0e5ee;
}

.item-list {
  position: sticky;
  fill: #2754eb;
  display: flex;
  justify-content: left;
  align-items: center;
  height: 50px;
  width: 100%;
  color: #343e5c;
  &-name {
    position: relative;
  }
}

.left {
  display: flex;
  justify-content: left;
}

.right {
  display: flex;
}

.item-list:hover {
  fill: #ffffff;
  color: #ffffff;
  background: #2754eb;
}

.item {
  display: flex;
}

.item-title {
  display: flex;
}

// a.router-link-active,
// li.item-list-active > a {
//   background: #ffffff;
// }

.active {
  color: #ffffff;
  fill: #ffffff;
  background: #2754eb;

  .sup-cymbol-counter {
    background: #ffffff;
    color: #2754eb;
  }
}

.sup-cymbol-counter {
  display: flex;
  position: absolute;
  right: -25px;
  top: -10px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  font-weight: bold;
  background: #2754eb;
  color: #ffffff;
  align-items: center;
  justify-content: center;
  padding: 1px;
  font-size: 12px;
  font-family: 'Open Sans', sans-serif;
}

@media screen and (max-width: 980px) {
  .profile-menu {
    margin-right: 10px;
  }
}

@media screen and (max-width: 670px) {
  .profile-menu {
    min-width: 220px;
    height: 73vh;
  }

  .icon-profile {
    padding-left: 10px;
  }

  .icon-education {
    padding-left: 10px;
  }
}

@media screen and (max-width: 560px) {
  .profile-menu {
    display: none;
  }
}
</style>
